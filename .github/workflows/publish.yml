name: Publish package to NPM
on:
  release:
    types: [created]

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
          registry-url: 'https://registry.npmjs.org'
      - run: npm publish --access=public
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}

  notification:
    needs: publish
    name: Notification
    runs-on: ubuntu-latest
    steps:
      - name: Send telegram message
        uses: appleboy/telegram-action@master
        with:
          token: ${{ secrets.TELEGRAM_TOKEN }}
          to: ${{ secrets.TELEGRAM_CHAT }}
          format: markdown
          message: |
            –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è: `@wb-tech/ui-react@${{ github.ref_name }}`

            –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—É—Ñ–µ—Ä üëÜ:
            NPM - `npm i @wb-tech/ui-react@${{ github.ref_name }} -S`
            Yarn - `yarn add @wb-tech/ui-react@${{ github.ref_name }} -S`
            PNPM - `pnpm add @wb-tech/ui-react@${{ github.ref_name }} -S`
